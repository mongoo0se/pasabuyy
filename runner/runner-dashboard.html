<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pa-Buy Bes! | Runner Dashboard</title>
    <link rel="stylesheet" href="runner-style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet Map Library -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body class="bg-gray-50 text-slate-900 flex h-screen overflow-hidden">
    <!-- SIDEBAR NAVIGATION -->
    <aside class="w-64 bg-white border-r border-gray-200 flex-shrink-0 flex flex-col z-20">
        <div class="p-6">
            <div class="flex items-center gap-3 text-blue-600">
                <div class="bg-blue-600 text-white p-2 rounded-lg">
                    <i data-lucide="bike" class="w-5 h-5"></i>
                </div>
                <div>
                    <span class="text-xl font-bold tracking-tight text-slate-800">Pa-Buy Bes!</span>
                    <p class="text-xs text-green-600 font-semibold">‚óè Online</p>
                </div>
            </div>
        </div>

        <nav class="flex-1 px-4 space-y-1">
            <button onclick="switchTab('dashboard')" class="nav-btn active w-full flex items-center gap-3 p-3 rounded-xl transition-all duration-200 text-blue-600 bg-blue-50 font-semibold">
                <i data-lucide="bar-chart-3" class="w-5 h-5"></i> Dashboard
            </button>
            <button onclick="switchTab('orders')" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl transition-all duration-200 text-slate-600 hover:bg-gray-100">
                <i data-lucide="package" class="w-5 h-5"></i> Available Orders
            </button>
            <button onclick="switchTab('active')" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl transition-all duration-200 text-slate-600 hover:bg-gray-100">
                <i data-lucide="map" class="w-5 h-5"></i> Active Delivery
            </button>
            <button onclick="switchTab('earnings')" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl transition-all duration-200 text-slate-600 hover:bg-gray-100">
                <i data-lucide="wallet" class="w-5 h-5"></i> Earnings
            </button>
            <button onclick="switchTab('profile')" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl transition-all duration-200 text-slate-600 hover:bg-gray-100">
                <i data-lucide="user" class="w-5 h-5"></i> Profile
            </button>
        </nav>

        <div class="p-4 border-t border-gray-100">
            <button onclick="logout()" class="w-full flex items-center gap-3 p-3 rounded-xl text-red-500 hover:bg-red-50 transition-colors">
                <i data-lucide="log-out" class="w-5 h-5"></i> Logout
            </button>
        </div>
    </aside>

    <!-- MAIN CONTENT AREA -->
    <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
        
        <!-- TOP HEADER -->
        <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-8">
            <h2 id="page-title" class="text-lg font-semibold text-slate-800">Dashboard Overview</h2>
            <div class="flex items-center gap-5">
                <div class="relative">
                    <button onclick="toggleNotificationPanel()" class="relative p-2 rounded-lg hover:bg-gray-100 transition">
                        <i data-lucide="bell" class="w-5 h-5 text-slate-600"></i>
                        <span id="notificationBadge" class="absolute top-1 right-1 w-5 h-5 bg-red-500 rounded-full border-2 border-white text-white text-xs flex items-center justify-center font-bold hidden">0</span>
                    </button>
                    
                    <!-- Notification Panel -->
                    <div id="notificationPanel" class="absolute right-0 top-12 w-96 bg-white rounded-2xl shadow-2xl border border-gray-200 hidden z-40 max-h-96 flex flex-col">
                        <!-- Header -->
                        <div class="p-4 border-b bg-gradient-to-r from-blue-50 to-blue-100">
                            <div class="flex items-center justify-between">
                                <h3 class="font-bold text-slate-800">Store Notifications</h3>
                                <button onclick="toggleNotificationPanel()" class="text-slate-400 hover:text-slate-600">
                                    <i data-lucide="x" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <p class="text-xs text-slate-600 mt-1">Deliveries & Updates</p>
                        </div>
                        
                        <!-- Notifications List -->
                        <div id="notificationsList" class="flex-1 overflow-y-auto">
                            <div class="p-4 text-center text-slate-500 text-sm">
                                No notifications yet
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div class="p-3 border-t text-center">
                            <button onclick="clearAllNotifications(); updateNotificationPanel();" class="text-xs text-blue-600 hover:text-blue-700 font-semibold">Clear All</button>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-3 pl-5 border-l">
                    <img src="https://ui-avatars.com/api/?name=Rider&background=0D8ABC&color=fff" class="w-8 h-8 rounded-full shadow-sm">
                    <span class="text-sm font-medium text-slate-700">Delivery Rider</span>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="flex-1 overflow-y-auto p-8">
            <!-- DASHBOARD SECTION -->
            <section id="dashboard-section" class="content-section active space-y-8">
                <!-- Stats Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-slate-500 text-sm font-medium">Today's Earnings</p>
                        <h3 class="text-2xl font-bold mt-2" id="todayEarnings">$0.00</h3>
                        <span class="text-green-500 text-xs font-bold mt-2 flex items-center gap-1" id="earningsDetail">
                            <i data-lucide="arrow-up-right" class="w-3 h-3"></i> 0 orders completed
                        </span>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-slate-500 text-sm font-medium">Your Rating</p>
                        <h3 class="text-2xl font-bold mt-2" id="ratingValue">‚Äî</h3>
                        <span class="text-blue-500 text-xs font-bold mt-2" id="ratingCount"></span>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-slate-500 text-sm font-medium">Orders Complete</p>
                        <h3 class="text-2xl font-bold mt-2" id="ordersComplete">0</h3>
                        <span class="text-slate-400 text-xs mt-2">This week: 0</span>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-slate-500 text-sm font-medium">Avg Delivery Time</p>
                        <h3 class="text-2xl font-bold mt-2" id="avgTime">‚Äî</h3>
                        <span class="text-slate-400 text-xs mt-2"></span>
                    </div>
                </div>

                <!-- Main Content Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left: Active Delivery & Performance -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Current Delivery Card -->
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                            <div class="flex justify-between items-center mb-6">
                                <h4 class="font-bold text-slate-800">Current Delivery</h4>
                                <span id="activeStatus" class="px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">In Progress</span>
                            </div>
                            <div id="activeDeliverySummary" class="space-y-4">
                                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                                    <span class="text-lg">üè™</span>
                                    <div>
                                        <p class="text-xs text-slate-500">From</p>
                                        <p id="fromStore" class="font-semibold"></p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                                    <span class="text-lg">üìç</span>
                                    <div>
                                        <p class="text-xs text-slate-500">To</p>
                                        <p id="toLocation" class="font-semibold"></p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                                    <span class="text-lg">üí∞</span>
                                    <div>
                
                                    </div>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                                    <span class="text-lg">‚è±Ô∏è</span>
                                    <div>
                                        <p class="text-xs text-slate-500">ETA</p>
                                        <p id="deliveryETA" class="font-semibold"></p>
                                    </div>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition-all" id="viewDeliveryBtn">
                                View Details
                            </button>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                            <h4 class="font-bold text-slate-800 mb-6">Performance Metrics</h4>
                            <div class="space-y-6">
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-slate-600">Acceptance Rate</span>
                                        <span class="text-sm font-bold text-slate-800">92%</span>
                                    </div>
                                    <div class="metric-bar"><div class="metric-fill" style="width: 92%;"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-slate-600">On-Time Delivery</span>
                                        <span class="text-sm font-bold text-slate-800">98%</span>
                                    </div>
                                    <div class="metric-bar"><div class="metric-fill" style="width: 98%;"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-slate-600">Customer Rating</span>
                                        <span class="text-sm font-bold text-slate-800">4.9 ‚≠ê</span>
                                    </div>
                                    <div class="metric-bar"><div class="metric-fill" style="width: 97%;"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-slate-600">This Week Income</span>
                                        <span class="text-sm font-bold text-slate-800">$182.50</span>
                                    </div>
                                    <div class="metric-bar"><div class="metric-fill" style="width: 75%;"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Upcoming Orders -->
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                        <div class="flex justify-between items-center mb-6">
                            <h4 class="font-bold text-slate-800">Next Pending Orders</h4>
                            <a href="#" class="text-blue-600 text-sm font-semibold hover:text-blue-700">View All ‚Üí</a>
                        </div>
                        <div id="pendingOrdersList" class="space-y-3">
                            <!-- Orders will be added dynamically -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- AVAILABLE ORDERS SECTION -->
            <section id="orders-section" class="content-section space-y-6">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">Available Orders</h3>
                    <div class="flex gap-4">
                        <select id="filterDistance" class="bg-white border border-gray-200 rounded-xl px-4 py-2 text-sm font-medium">
                            <option value="">All Distances</option>
                            <option value="short">Less than 1 km</option>
                            <option value="medium">1-3 km</option>
                            <option value="long">3+ km</option>
                        </select>
    
                    </div>
                </div>
                
                <div id="ordersEmptyState" class="hidden text-center py-12">
                    <div class="text-4xl mb-2">üì≠</div>
                    <h3 class="text-lg font-semibold text-slate-800">No orders available</h3>
                    <p class="text-slate-500">Check back soon or adjust your filters</p>
                </div>

                <div id="ordersGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Order cards will be dynamically generated -->
                </div>
            </section>

            <!-- ORDER DETAILS MODAL -->
            <div id="orderModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4 overflow-y-auto">
                <div class="bg-white rounded-2xl w-full max-w-2xl shadow-2xl my-8">
                    <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white rounded-t-2xl">
                        <h3 class="text-xl font-bold">Order Details & Map</h3>
                        <button onclick="closeOrderModal()" class="text-slate-400 hover:text-slate-600"><i data-lucide="x" class="w-6 h-6"></i></button>
                    </div>
                    
                    <div class="p-6 space-y-6">
                        <!-- Live Map -->
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl h-72 flex flex-col items-center justify-center border-2 border-dashed border-blue-300">
                            <i data-lucide="map" class="w-16 h-16 text-blue-400 mb-4"></i>
                            <p class="text-blue-800 font-semibold">Live GPS Map</p>
                            <p class="text-blue-600 text-sm">Route visualization with real-time location tracking</p>
                            <button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition">Open Live Map</button>
                        </div>

                        <!-- Order Information Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Pickup Details -->
                            <div class="bg-slate-50 p-4 rounded-xl">
                                <div class="flex items-center gap-2 mb-3">
                                    <i data-lucide="store" class="w-5 h-5 text-orange-500"></i>
                                    <h4 class="font-bold text-slate-800">Pickup</h4>
                                </div>
                                <div id="ordModalPickup" class="space-y-2 text-sm">
                                    <p class="font-semibold text-slate-800">Restaurant Name</p>
                                    <p class="text-slate-600">Address details here</p>
                                    <div class="mt-3 pt-3 border-t">
                                        <p class="text-xs text-slate-500 uppercase font-bold">Estimated Wait</p>
                                        <p class="font-semibold text-slate-800">5-10 minutes</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Dropoff Details -->
                            <div class="bg-slate-50 p-4 rounded-xl">
                                <div class="flex items-center gap-2 mb-3">
                                    <i data-lucide="map-pin" class="w-5 h-5 text-green-500"></i>
                                    <h4 class="font-bold text-slate-800">Delivery To</h4>
                                </div>
                                <div id="ordModalDropoff" class="space-y-2 text-sm">
                                    <p class="font-semibold text-slate-800">Customer Address</p>
                                    <p class="text-slate-600">Full address with unit/apt</p>
                                    <div class="mt-3 pt-3 border-t">
                                        <p class="text-xs text-slate-500 uppercase font-bold">Distance</p>
                                        <p class="font-semibold text-slate-800">2.5 km</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Distance & Time -->
                            <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                                <div class="flex items-center gap-2 mb-3">
                                    <i data-lucide="navigation" class="w-5 h-5 text-blue-600"></i>
                                    <h4 class="font-bold text-slate-800">Distance & Time</h4>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-slate-600">Total Distance:</span>
                                        <span id="ordModalDistance" class="font-bold text-slate-800">2.5 km</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-600">Estimated Time:</span>
                                        <span id="ordModalTime" class="font-bold text-slate-800">15 min</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Items Count -->
                            <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                                <div class="flex items-center gap-2 mb-3">
                                    <i data-lucide="package" class="w-5 h-5 text-blue-600"></i>
                                    <h4 class="font-bold text-slate-800">Order Summary</h4>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-slate-600">Items Count:</span>
                                        <span id="ordModalItems" class="font-bold text-slate-800">3 items</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Order Items -->
                        <div class="bg-white border border-gray-200 rounded-xl p-4">
                            <h4 class="font-bold text-slate-800 mb-3">Order Items</h4>
                            <div id="ordModalItemsList" class="space-y-2 text-sm">
                                <!-- No sample order items -->
                            </div>
                        </div>

                        <!-- Customer Info -->
                        <div class="bg-slate-50 p-4 rounded-xl">
                            <h4 class="font-bold text-slate-800 mb-3">Customer Info</h4>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <img src="https://ui-avatars.com/api/?name=Customer&background=0D8ABC&color=fff" class="w-10 h-10 rounded-full">
                                    <div>
                                        <p id="ordModalCustName" class="font-semibold text-slate-800">John Doe</p>
                                        <p class="text-xs text-slate-500">Rating: <span id="ordModalCustRating">4.8</span> ‚≠ê</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button class="p-2 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg"><i data-lucide="phone" class="w-4 h-4"></i></button>
                                    <button class="p-2 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg"><i data-lucide="message-circle" class="w-4 h-4"></i></button>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-3 pt-4">
                            <button onclick="window.currentOrderId && declineOrder(window.currentOrderId); closeOrderModal();" class="flex-1 bg-red-100 hover:bg-red-200 text-red-600 font-bold py-3 rounded-xl transition flex items-center justify-center gap-2">
                                <i data-lucide="x" class="w-5 h-5"></i> Decline
                            </button>
                            <button onclick="acceptOrder()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2">
                                <i data-lucide="check" class="w-5 h-5"></i> Accept Order
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ACTIVE DELIVERY SECTION -->
            <section id="active-section" class="content-section space-y-6">
                <div id="activeEmptyState" class="text-center py-12">
                    <div class="text-4xl mb-2">üèÅ</div>
                    <h3 class="text-lg font-semibold text-slate-800">No active delivery</h3>
                    <p class="text-slate-500">Accept an order to start tracking your delivery</p>
                </div>

                <div id="activeDeliveryContainer" class="hidden space-y-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">Active Delivery</h3>
                        <div class="flex items-center gap-3">
                            <div class="text-center">
                                <p class="text-xs text-slate-500 uppercase font-bold">Time Elapsed</p>
                                <p id="deliveryTimer" class="text-lg font-bold text-blue-600"></p>
                            </div>
                            <span id="activeOrderId" class="px-3 py-1 bg-blue-100 text-blue-700 text-xs font-bold rounded-full"></span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Left: Delivery Details & Map -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Live GPS Map with Full Screen Option -->
                            <div class="bg-white rounded-2xl border-2 border-blue-200 relative shadow-sm overflow-hidden">
                                <div id="deliveryMap" class="w-full h-96 relative" style="min-height: 400px;"></div>
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button onclick="centerMapOnDelivery()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2 shadow-lg">
                                        <i data-lucide="target" class="w-4 h-4"></i> Center
                                    </button>
                                    <button onclick="toggleFullscreenMap()" class="bg-white hover:bg-blue-50 text-blue-600 border border-blue-300 px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2 shadow-lg">
                                        <i data-lucide="maximize-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <!-- Map Info Panel -->
                                <div class="absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-3 z-10 max-w-xs">
                                    <p class="text-xs text-slate-500 font-bold uppercase">Current Location</p>
                                    <p id="currentLocationText" class="text-sm font-semibold text-slate-800">Loading...</p>
                                    <div class="flex gap-2 mt-2 text-xs">
                                        <span class="text-slate-600"><strong>Distance:</strong> <span id="mapDistance">--</span></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Delivery Status Timeline -->
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                <h4 class="font-bold text-slate-800 mb-6">Delivery Status</h4>
                                <div class="space-y-4">
                                    <!-- Status Step 1 -->
                                    <div class="flex gap-4">
                                        <div class="flex flex-col items-center">
                                            <div class="w-8 h-8 rounded-full bg-green-100 border-2 border-green-500 flex items-center justify-center">
                                                <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                            <div class="w-1 h-12 bg-green-300 mt-2"></div>
                                        </div>
                                        <div class="pt-1">
                                            <p class="font-bold text-slate-800">Order Accepted</p>
                                            <p class="text-xs text-slate-500"></p>
                                        </div>
                                    </div>

                                    <!-- Status Step 2 -->
                                    <div class="flex gap-4">
                                        <div class="flex flex-col items-center">
                                            <div class="w-8 h-8 rounded-full bg-blue-100 border-2 border-blue-500 flex items-center justify-center">
                                                <i data-lucide="navigation" class="w-4 h-4 text-blue-600"></i>
                                            </div>
                                            <div class="w-1 h-12 bg-gray-300 mt-2"></div>
                                        </div>
                                        <div class="pt-1">
                                            <p class="font-bold text-slate-800">On the Way to Pickup</p>
                                            <p class="text-xs text-slate-500">Currently active</p>
                                        </div>
                                    </div>

                                    <!-- Status Step 3 -->
                                    <div class="flex gap-4">
                                        <div class="flex flex-col items-center">
                                            <div class="w-8 h-8 rounded-full bg-gray-100 border-2 border-gray-400 flex items-center justify-center">
                                                <i data-lucide="package" class="w-4 h-4 text-gray-600"></i>
                                            </div>
                                            <div class="w-1 h-12 bg-gray-300 mt-2"></div>
                                        </div>
                                        <div class="pt-1">
                                            <p class="font-bold text-slate-800">Pick up food</p>
                                            <p class="text-xs text-slate-500">Pending</p>
                                        </div>
                                    </div>

                                    <!-- Status Step 4 -->
                                    <div class="flex gap-4">
                                        <div class="flex flex-col items-center">
                                            <div class="w-8 h-8 rounded-full bg-gray-100 border-2 border-gray-400 flex items-center justify-center">
                                                <i data-lucide="home" class="w-4 h-4 text-gray-600"></i>
                                            </div>
                                        </div>
                                        <div class="pt-1">
                                            <p class="font-bold text-slate-800">Deliver to customer</p>
                                            <p class="text-xs text-slate-500">Pending</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pickup Location -->
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                <div class="flex items-center gap-2 mb-4">
                                    <i data-lucide="store" class="w-5 h-5 text-orange-500"></i>
                                    <h4 class="font-bold text-slate-800">Pickup Location</h4>
                                </div>
                                <div class="space-y-2 mb-4">
                                    <h5 id="pickupStore" class="font-semibold text-slate-800">Pizza Palace</h5>
                                    <p id="pickupAddress" class="text-slate-600 text-sm">123 Main St, Downtown</p>
                                    <p id="pickupTime" class="text-slate-500 text-xs">Estimated wait: 5 min</p>
                                </div>
                                <button class="w-full bg-orange-100 hover:bg-orange-200 text-orange-600 font-semibold py-2 rounded-lg transition-colors" id="arrivedBtn">
                                    Mark Arrived at Pickup
                                </button>
                            </div>

                            <!-- Dropoff Location -->
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                <div class="flex items-center gap-2 mb-4">
                                    <i data-lucide="home" class="w-5 h-5 text-green-500"></i>
                                    <h4 class="font-bold text-slate-800">Dropoff Location</h4>
                                </div>
                                <div class="space-y-2 mb-4">
                                    <h5 id="dropoffLocation" class="font-semibold text-slate-800">456 Oak Ave</h5>
                                    <p id="dropoffDetails" class="text-slate-600 text-sm">Apt 305, Building B</p>
                                    <p id="dropoffTime" class="text-slate-500 text-xs">Estimated delivery: 18 min</p>
                                </div>
                                <button class="w-full bg-green-100 hover:bg-green-200 text-green-600 font-semibold py-2 rounded-lg transition-colors" id="getDirectionsBtn">
                                    Get Directions
                                </button>
                            </div>

                            <!-- Order Details -->
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                <h4 class="font-bold text-slate-800 mb-4">Order Details</h4>
                                <div id="orderDetailsList" class="space-y-3">
                                    <!-- Items will be added dynamically -->
                                </div>
                            </div>

                            <!-- Customer Info -->
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                <h4 class="font-bold text-slate-800 mb-4">Customer Info</h4>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <img src="https://ui-avatars.com/api/?name=Customer&background=0D8ABC&color=fff" class="w-10 h-10 rounded-full">
                                        <div>
                                            <h5 id="customerName" class="font-semibold text-slate-800">John Doe</h5>
                                            <p id="customerRating" class="text-xs text-slate-500">Rating: 4.8 ‚≠ê</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="p-2 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg" title="Call">
                                            <i data-lucide="phone" class="w-4 h-4"></i>
                                        </button>
                                        <button class="p-2 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg" title="Message">
                                            <i data-lucide="message-circle" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right: Controls & Camera -->
                        <div class="space-y-6">
                            <!-- Navigation Controls -->
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm space-y-4">
                                <h4 class="font-bold text-slate-800">Navigation</h4>
                                <div class="flex justify-between items-center">
                                    <span class="text-slate-600 text-sm font-medium">Distance</span>
                                    <span id="remainDistance" class="font-bold text-slate-800"></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-slate-600 text-sm font-medium">ETA</span>
                                    <span id="remainETA" class="font-bold text-slate-800"></span>
                                </div>

                            </div>

                            <!-- Delivery Photo Capture -->
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                <h4 class="font-bold text-slate-800 mb-4">Delivery Proof</h4>
                                <div id="photoCaptureContainer" class="space-y-4">
                                    <div id="photoPreview" class="hidden">
                                        <img id="capturedPhoto" src="" class="w-full h-48 object-cover rounded-lg mb-3">
                                        <button onclick="retakePhoto()" class="w-full bg-blue-100 hover:bg-blue-200 text-blue-600 font-semibold py-2 rounded-lg transition">
                                            Retake Photo
                                        </button>
                                    </div>
                                    <div id="noCameraState" class="text-center py-8">
                                        <i data-lucide="camera" class="w-12 h-12 text-slate-300 mx-auto mb-3"></i>
                                        <p class="text-slate-600 font-medium">Capture Photo</p>
                                        <p class="text-slate-400 text-sm">Take a photo when delivered</p>
                                        <input type="file" id="photoInput" accept="image/*" class="hidden" onchange="handlePhotoUpload(this)">
                                        <div class="mt-3 space-y-2">
                                            <button onclick="document.getElementById('photoInput').click()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg transition flex items-center justify-center gap-2">
                                                <i data-lucide="upload" class="w-4 h-4"></i> Upload Photo
                                            </button>
                                            <button onclick="captureFromCamera()" class="w-full bg-slate-600 hover:bg-slate-700 text-white font-semibold py-2 rounded-lg transition flex items-center justify-center gap-2">
                                                <i data-lucide="camera" class="w-4 h-4"></i> Use Camera
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Delivery Actions -->
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm space-y-3">
                                <button onclick="openRatingModal()" id="completeDeliveryBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-xl transition-all flex items-center justify-center gap-2" disabled>
                                    <i data-lucide="check-circle" class="w-5 h-5"></i> Complete Delivery
                                </button>
                                <button class="w-full bg-red-100 hover:bg-red-200 text-red-600 font-semibold py-3 rounded-xl transition-colors" id="cancelDeliveryBtn">
                                    Cancel Delivery
                                </button>
                            </div>

                            <!-- Issues/Support -->
                            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                <h4 class="font-bold text-slate-800 mb-3">Support</h4>
                                <button class="w-full flex items-center gap-3 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg transition text-slate-700">
                                    <i data-lucide="alert-circle" class="w-5 h-5 text-orange-500"></i>
                                    <span class="font-semibold">Report Issue</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rating Modal -->
                <div id="ratingModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4">
                    <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl">
                        <div class="p-6 border-b">
                            <h3 class="text-xl font-bold">Rate Your Delivery</h3>
                            <p class="text-slate-500 text-sm mt-1">How was your experience?</p>
                        </div>
                        
                        <div class="p-6 space-y-6">
                            <!-- Customer Rating -->
                            <div>
                                <p class="text-sm font-bold text-slate-700 mb-3">How would you rate the customer?</p>
                                <div id="customerRatingStars" class="flex gap-2 text-3xl justify-center">
                                    <button class="star-btn hover:scale-110 transition" data-rating="1">‚≠ê</button>
                                    <button class="star-btn hover:scale-110 transition" data-rating="2">‚≠ê</button>
                                    <button class="star-btn hover:scale-110 transition" data-rating="3">‚≠ê</button>
                                    <button class="star-btn hover:scale-110 transition" data-rating="4">‚≠ê</button>
                                    <button class="star-btn hover:scale-110 transition" data-rating="5">‚≠ê</button>
                                </div>
                            </div>

                            <!-- Feedback -->
                            <div>
                                <label class="text-sm font-bold text-slate-700 mb-2 block">Any feedback?</label>
                                <textarea id="feedbackText" class="w-full border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Optional: Tell us about your experience..."></textarea>
                            </div>

                            <!-- Delivery Issues (Optional) -->
                            <div>
                                <label class="text-sm font-bold text-slate-700 mb-3 block">Any issues?</label>
                                <div class="space-y-2">
                                    <button class="w-full text-left p-3 border border-red-200 bg-red-50 hover:bg-red-100 rounded-lg text-sm text-red-700 font-medium transition">
                                        <i data-lucide="x" class="w-4 h-4 inline mr-2"></i> Rude/Disruptive customer
                                    </button>
                                    <button class="w-full text-left p-3 border border-red-200 bg-red-50 hover:bg-red-100 rounded-lg text-sm text-red-700 font-medium transition">
                                        <i data-lucide="alert-triangle" class="w-4 h-4 inline mr-2"></i> Unsafe neighborhood
                                    </button>
                                    <button class="w-full text-left p-3 border border-red-200 bg-red-50 hover:bg-red-100 rounded-lg text-sm text-red-700 font-medium transition">
                                        <i data-lucide="map-pin" class="w-4 h-4 inline mr-2"></i> Wrong address
                                    </button>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex gap-3">
                                <button onclick="closeRatingModal()" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-3 rounded-xl transition">
                                    Skip
                                </button>
                                <button onclick="submitRating()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2">
                                    <i data-lucide="send" class="w-4 h-4"></i> Submit
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Completion Modal -->
                <div id="completionModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4">
                    <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl text-center p-8 space-y-4">
                        <div class="text-6xl mb-4">‚ú®</div>
                        <h3 class="text-2xl font-bold text-slate-800">Delivery Complete!</h3>
                        <p class="text-slate-600">Great job! Your customer will be notified.</p>
                        
                        <!-- Store Notification Confirmation -->
                        <div id="storeNotificationDiv" class="bg-blue-50 p-4 rounded-xl border border-blue-200 hidden">
                            <div class="flex items-center gap-2 text-blue-700">
                                <i data-lucide="check-circle" class="w-5 h-5"></i>
                                <div class="text-left">
                                    <p class="text-sm font-bold">Store Notified</p>
                                    <p id="storeNotificationMsg" class="text-xs text-blue-600">Order delivery confirmed to store owner</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                            <p class="text-sm text-slate-600">Earnings for this delivery:</p>
                            <p class="text-3xl font-bold text-green-600">$5.50</p>
                        </div>
                        <button onclick="resetDelivery()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition">
                            Back to Orders
                        </button>
                    </div>
                </div>
            </section>

            <!-- EARNINGS SECTION -->
            <section id="earnings-section" class="content-section space-y-6">
                <h3 class="text-xl font-bold">Earnings & Analytics</h3>

                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-slate-500 text-sm font-medium">Today's Earnings</p>
                        <h3 class="text-2xl font-bold mt-2" id="summaryToday">$0.00</h3>
                        <span class="text-slate-400 text-xs mt-2">0 deliveries</span>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-slate-500 text-sm font-medium">This Week</p>
                        <h3 class="text-2xl font-bold mt-2" id="summaryWeek">$0.00</h3>
                        <span class="text-slate-400 text-xs mt-2">0 deliveries</span>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-slate-500 text-sm font-medium">This Month</p>
                        <h3 class="text-2xl font-bold mt-2" id="summaryMonth">$0.00</h3>
                        <span class="text-slate-400 text-xs mt-2">0 deliveries</span>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-slate-500 text-sm font-medium">Total Earned</p>
                        <h3 class="text-2xl font-bold mt-2" id="summaryTotal">$0.00</h3>
                        <span class="text-slate-400 text-xs mt-2">0 total deliveries</span>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="border-b border-gray-200">
                    <div class="flex gap-8">
                        <button class="tab-btn active px-4 py-4 text-sm font-semibold text-blue-600 border-b-2 border-blue-600" data-tab="daily">Daily</button>
                        <button class="tab-btn px-4 py-4 text-sm font-semibold text-slate-600 border-b-2 border-transparent hover:text-slate-800" data-tab="weekly">Weekly</button>
                        <button class="tab-btn px-4 py-4 text-sm font-semibold text-slate-600 border-b-2 border-transparent hover:text-slate-800" data-tab="monthly">Monthly</button>
                    </div>
                </div>

                <!-- Chart -->
                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                    <h4 class="font-bold text-slate-800 mb-6">Earnings Analytics</h4>
                    <canvas id="earningsChart" height="140"></canvas>
                </div>

                <!-- Breakdown Table -->
                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                    <h4 class="font-bold text-slate-800 mb-6">Daily Breakdown</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-slate-50 border-b border-slate-100">
                                <tr>
                                    <th class="px-4 py-3 text-xs font-bold text-slate-500 uppercase">Date</th>
                                    <th class="px-4 py-3 text-xs font-bold text-slate-500 uppercase">Orders</th>
                                    <th class="px-4 py-3 text-xs font-bold text-slate-500 uppercase">Earnings</th>
                                    <th class="px-4 py-3 text-xs font-bold text-slate-500 uppercase">Distance</th>
                                </tr>
                            </thead>
                            <tbody id="breakdownRows" class="divide-y divide-gray-100">
                                <!-- Rows will be dynamically added -->
                            </tbody>
                        </table>
                    </div>
                </div>


            </section>

            <!-- PROFILE SECTION -->
            <section id="profile-section" class="content-section">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Profile Information -->
                    <div class="lg:col-span-2">
                        <!-- Personal Information -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                            <div class="flex items-center gap-6 mb-6">
                                <div class="w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-semibold" id="avatarInitials">JD</div>
                                <div>
                                    <div class="flex items-center gap-2">
                                        <h2 class="text-2xl font-bold"><span id="profileDisplayName">John Doe</span></h2>
                                        <span id="verificationBadge" class="hidden inline-flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold">
                                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                            Verified
                                        </span>
                                    </div>
                                    <p class="text-gray-600" id="profileDisplayEmail">john.doe@email.com</p>
                                    <p class="text-sm text-gray-500" id="profileDisplayMember">Member since March 2024</p>
                                </div>
                            </div>

                            <div class="space-y-4 border-t border-gray-200 pt-6">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">First Name</label>
                                        <input type="text" id="firstName" placeholder="First Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Last Name</label>
                                        <input type="text" id="lastName" placeholder="Last Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                                    <input type="email" id="emailInput" placeholder="Email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Phone</label>
                                    <input type="tel" id="phoneInput" placeholder="Phone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <button onclick="saveProfile()" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 font-semibold">Save Changes</button>
                            </div>
                        </div>

                        <!-- Verify Account Button -->
                        <div class="bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-lg shadow-sm p-6 mb-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Verify Your Account</h3>
                                    <p class="text-sm text-gray-600 mt-1">Complete verification to unlock premium features and increase trust</p>
                                </div>
                                <button onclick="openVerifyModal()" class="px-6 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition-all">Start Verification</button>
                            </div>
                        </div>

                        <!-- Addresses -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold">Saved Addresses</h3>
                                <button onclick="addAddress()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">+ Add Address</button>
                            </div>
                            <div class="space-y-4" id="addressesList">
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="flex items-start justify-between mb-2">
                                        <h4 class="font-semibold">Home</h4>
                                        <div class="flex gap-2">
                                            <button onclick="editAddress()" class="text-blue-500 hover:text-blue-700">Edit</button>
                                            <button onclick="deleteAddress()" class="text-red-500 hover:text-red-700">Delete</button>
                                        </div>
                                    </div>
                                    <p class="text-sm text-gray-600">123 Main Street</p>
                                    <p class="text-sm text-gray-600">City, State 12345</p>
                                    <p class="text-sm text-gray-600 mt-2">Phone: +92 300 1234567</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar Stats -->
                    <div>
                        <!-- Account Stats -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                            <h3 class="font-semibold mb-4">Account Statistics</h3>
                            <div class="space-y-4">
                                <div>
                                    <p class="text-sm text-gray-600">Total Orders</p>
                                    <p class="text-3xl font-bold text-blue-600" id="statsOrders">0</p>
                                </div>
                                <hr class="border-gray-200">
                                <div>
                                    <p class="text-sm text-gray-600">Total Spent</p>
                                    <p class="text-3xl font-bold text-green-600" id="statsSpent">‚Ç±0</p>
                                </div>
                                <hr class="border-gray-200">
                                <!-- Loyalty points removed -->
                            </div>
                        </div>

                        <!-- Security Settings -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <h3 class="font-semibold mb-4">Security</h3>
                            <div class="space-y-3">
                                <button onclick="changePassword()" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded-lg">Change Password</button>
                                <button onclick="enableTwoFA()" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded-lg">Two-Factor Authentication</button>
                                <button onclick="viewLoginHistory()" class="w-full text-left px-3 py-2 hover:bg-gray-100 rounded-lg">Login History</button>
                                <button onclick="deleteAccount()" class="w-full text-left px-3 py-2 hover:bg-red-100 text-red-600 rounded-lg">Delete Account</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Verification Modal -->
                <div id="verifyModal" class="hidden fixed inset-0 bg-slate-950/50 backdrop-blur-sm flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="bg-gradient-to-r from-orange-600 to-orange-500 p-8 text-white">
                            <h2 class="text-3xl font-bold flex items-center gap-3">
                                <i data-lucide="shield-check" class="w-8 h-8"></i> Account Verification
                            </h2>
                            <p class="text-orange-100 mt-2">Upload identity documents to verify your account and unlock premium features</p>
                        </div>

                        <form id="verifyForm" class="p-8">
                            <!-- Government ID Section -->
                            <fieldset class="border rounded-xl p-6 mb-6">
                                <legend class="text-lg font-bold text-slate-900 px-2">Government-Issued ID</legend>
                                <p class="text-slate-600 text-sm mb-4 mt-2">Upload front and back of your ID (Passport, Driver's License, or National ID)</p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- ID Front -->
                                    <div class="border-2 border-dashed border-slate-300 rounded-xl p-4 text-center cursor-pointer hover:border-orange-500 hover:bg-orange-50 transition-all" onclick="document.getElementById('idFront').click()">
                                        <div id="idFrontPreview" class="mb-4">
                                            <i data-lucide="image" class="w-12 h-12 mx-auto text-slate-400"></i>
                                            <p class="text-slate-600 text-sm mt-2">Click to upload ID Front</p>
                                        </div>
                                        <input type="file" id="idFront" name="id_front" accept=".jpg,.jpeg,.png,.pdf" class="hidden">
                                    </div>

                                    <!-- ID Back -->
                                    <div class="border-2 border-dashed border-slate-300 rounded-xl p-4 text-center cursor-pointer hover:border-orange-500 hover:bg-orange-50 transition-all" onclick="document.getElementById('idBack').click()">
                                        <div id="idBackPreview" class="mb-4">
                                            <i data-lucide="image" class="w-12 h-12 mx-auto text-slate-400"></i>
                                            <p class="text-slate-600 text-sm mt-2">Click to upload ID Back</p>
                                        </div>
                                        <input type="file" id="idBack" name="id_back" accept=".jpg,.jpeg,.png,.pdf" class="hidden">
                                    </div>
                                </div>
                            </fieldset>

                            <!-- Selfie with ID Section -->
                            <fieldset class="border rounded-xl p-6 mb-6">
                                <legend class="text-lg font-bold text-slate-900 px-2">Selfie with ID</legend>
                                <p class="text-slate-600 text-sm mb-4 mt-2">Upload a selfie holding your ID for face verification</p>
                                
                                <div class="border-2 border-dashed border-slate-300 rounded-xl p-6 text-center cursor-pointer hover:border-orange-500 hover:bg-orange-50 transition-all" onclick="document.getElementById('selfieId').click()">
                                    <div id="selfiePreview" class="mb-4">
                                        <i data-lucide="camera" class="w-12 h-12 mx-auto text-slate-400"></i>
                                        <p class="text-slate-600 text-sm mt-2">Click to upload Selfie with ID</p>
                                    </div>
                                    <input type="file" id="selfieId" name="selfie_with_id" accept=".jpg,.jpeg,.png" class="hidden">
                                </div>
                            </fieldset>

                            <!-- Proof of Address Section -->
                            <fieldset class="border rounded-xl p-6 mb-6">
                                <legend class="text-lg font-bold text-slate-900 px-2">Proof of Address</legend>
                                <p class="text-slate-600 text-sm mb-4 mt-2">Upload a utility bill, lease agreement, or bank statement (PDF or image)</p>
                                
                                <div class="border-2 border-dashed border-slate-300 rounded-xl p-6 text-center cursor-pointer hover:border-orange-500 hover:bg-orange-50 transition-all" onclick="document.getElementById('addressProof').click()">
                                    <div id="addressPreview" class="mb-4">
                                        <i data-lucide="file-text" class="w-12 h-12 mx-auto text-slate-400"></i>
                                        <p class="text-slate-600 text-sm mt-2">Click to upload Proof of Address</p>
                                    </div>
                                    <input type="file" id="addressProof" name="address_proof" accept=".jpg,.jpeg,.png,.pdf" class="hidden">
                                </div>
                            </fieldset>

                            <!-- Contact Number -->
                            <fieldset class="border rounded-xl p-6 mb-6">
                                <legend class="text-lg font-bold text-slate-900 px-2">Contact Number</legend>
                                <p class="text-slate-600 text-sm mb-4 mt-2">Provide your contact number for verification purposes</p>
                                
                                <input type="tel" id="contactNumber" name="contact_number" placeholder="+92 300 1234567" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </fieldset>

                            <!-- Submit Buttons -->
                            <div class="flex gap-3 justify-end">
                                <button type="button" onclick="closeVerifyModal()" class="px-6 py-3 bg-slate-200 hover:bg-slate-300 text-slate-900 rounded-lg font-semibold transition-all">
                                    Cancel
                                </button>
                                <button type="submit" class="px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-semibold transition-all flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-5 h-5"></i> Submit for Verification
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

            </section>
        </main>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // Page Load Initialization
        document.addEventListener('DOMContentLoaded', function() {
            generateOrderCards();
            
            // Initialize profile
            loadProfile();
        });

        // Tab Switching System
        function switchTab(tabId) {
            const titles = {
                'dashboard': 'Dashboard Overview',
                'orders': 'Available Orders',
                'active': 'Active Delivery',
                'earnings': 'Earnings & Analytics',
                'profile': 'My Profile'
            };
            document.getElementById('page-title').innerText = titles[tabId];

            // Toggle Active Sections
            document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(`${tabId}-section`).classList.add('active');

            // Update Navigation UI
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-blue-600', 'bg-blue-50', 'font-semibold');
                btn.classList.add('text-slate-600');
            });
            event.currentTarget.classList.add('text-blue-600', 'bg-blue-50', 'font-semibold');
        }

        // Logout handler
        function logout() {
            window.location.href = '../index.html';
        }

        // Profile Variables (no local defaults)
        let userProfile = {
            firstName: "John",
            lastName: "Doe", 
            email: "john.doe@email.com",
            phone: "+92 300 1234567",
            memberSince: "March 2024",
            totalOrders: 28,
            totalSpent: "‚Ç±4,250"
        };

        // Load Profile Data
        function loadProfile() {
            const fullName = userProfile.firstName + ' ' + userProfile.lastName;
            
            // Clear and set profile display name properly
            const nameElement = document.getElementById('profileDisplayName');
            nameElement.textContent = fullName;
            
            // Check if user is verified and show/hide badge
            const verificationBadge = document.getElementById('verificationBadge');
            const verifyData = JSON.parse(localStorage.getItem('verificationData') || '{}');
            
            if (verifyData && verifyData.contactNumber && verifyData.status === 'pending') {
                verificationBadge.classList.remove('hidden');
            } else if (verifyData && verifyData.status === 'verified') {
                verificationBadge.classList.remove('hidden');
            } else {
                verificationBadge.classList.add('hidden');
            }
            
            document.getElementById('profileDisplayEmail').innerText = userProfile.email;
            document.getElementById('profileDisplayMember').innerText = 'Member since ' + userProfile.memberSince;
            
            // Load form fields
            document.getElementById('firstName').value = userProfile.firstName;
            document.getElementById('lastName').value = userProfile.lastName;
            document.getElementById('emailInput').value = userProfile.email;
            document.getElementById('phoneInput').value = userProfile.phone;
            
            // Load stats
            document.getElementById('statsOrders').innerText = userProfile.totalOrders;
            document.getElementById('statsSpent').innerText = userProfile.totalSpent;
            
            // Update avatar initials
            const initials = userProfile.firstName.charAt(0) + userProfile.lastName.charAt(0);
            document.getElementById('avatarInitials').innerText = initials.toUpperCase();
        }

        // Save Profile Changes
        function saveProfile() {
            userProfile.firstName = document.getElementById('firstName').value;
            userProfile.lastName = document.getElementById('lastName').value;
            userProfile.email = document.getElementById('emailInput').value;
            userProfile.phone = document.getElementById('phoneInput').value;
            
            if (!userProfile.firstName || !userProfile.lastName || !userProfile.email) {
                alert("Please fill all required fields");
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            alert("Profile saved successfully!");
            
            // Update display
            loadProfile();
        }

        // Add Address Function
        function addAddress() {
            const name = prompt("Address Name (e.g., Home, Work):");
            if (!name) return;
            
            const street = prompt("Street Address:");
            if (!street) return;
            
            const city = prompt("City:");
            if (!city) return;
            
            const phone = prompt("Phone Number:");
            if (!phone) return;
            
            const addressesList = document.getElementById('addressesList');
            const newAddress = document.createElement('div');
            newAddress.className = 'border border-gray-200 rounded-lg p-4';
            newAddress.innerHTML = `
                <div class="flex items-start justify-between mb-2">
                    <h4 class="font-semibold">${name}</h4>
                    <div class="flex gap-2">
                        <button onclick="editAddress(this)" class="text-blue-500 hover:text-blue-700">Edit</button>
                        <button onclick="deleteAddress(this)" class="text-red-500 hover:text-red-700">Delete</button>
                    </div>
                </div>
                <p class="text-sm text-gray-600">${street}</p>
                <p class="text-sm text-gray-600">${city}</p>
                <p class="text-sm text-gray-600 mt-2">Phone: ${phone}</p>
            `;
            addressesList.appendChild(newAddress);
        }

        // Edit Address Function
        function editAddress(btn) {
            if (typeof btn === 'string') {
                alert("Select an address to edit");
            } else {
                alert("Edit address feature coming soon!");
            }
        }

        // Delete Address Function
        function deleteAddress(btn) {
            if (typeof btn === 'string') {
                alert("Select an address to delete");
            } else {
                if (confirm("Are you sure you want to delete this address?")) {
                    btn.closest('div').remove();
                }
            }
        }

        // Enable Two-Factor Authentication
        function enableTwoFA() {
            alert("Two-Factor Authentication setup coming soon!");
        }

        // View Login History
        function viewLoginHistory() {
            alert("Login History:\n\n1. Today at 2:45 PM - Google Chrome\n2. Yesterday at 10:30 AM - Safari\n3. 2 days ago at 8:15 PM - Android App");
        }

        // Delete Account
        function deleteAccount() {
            if (confirm("Are you sure you want to delete your account? This action cannot be undone.")) {
                if (confirm("Type 'DELETE' to confirm account deletion.")) {
                    alert("Account deletion request submitted. You will receive a confirmation email.");
                }
            }
        }




        // Generate Order Cards
        function generateOrderCards() {
            const container = document.getElementById('ordersGrid');
            const emptyState = document.getElementById('ordersEmptyState');
            
            if (sampleOrders.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            container.innerHTML = sampleOrders.map(order => `
                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-all cursor-pointer" data-order-id="${order.id}">
                    <!-- Store Header -->
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h4 class="font-bold text-slate-800 text-lg">${order.storeName}</h4>
                            <p class="text-sm text-slate-500">${order.cuisine}</p>
                        </div>
                        <span class="text-2xl">üçΩÔ∏è</span>
                    </div>
                    
                    <!-- Quick Info -->
                    <div class="grid grid-cols-3 gap-4 mb-4 p-3 bg-slate-50 rounded-lg">
                        <div class="text-center">
                            <p class="text-xs text-slate-500">Distance</p>
                            <p class="font-bold text-slate-800">${order.distance}</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-slate-500">Time</p>
                            <p class="font-bold text-slate-800">${order.estimatedTime} min</p>
                        </div>

                    </div>
                    
                    <!-- Customer and Items Preview -->
                    <div class="mb-4 pb-4 border-b border-gray-100">
                        <p class="text-xs text-slate-500 mb-2">üì¶ ${order.items.length} items</p>
                        <p class="text-sm text-slate-600">${order.items.slice(0, 2).map(i => i.name).join(', ')}${order.items.length > 2 ? '...' : ''}</p>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-2">
                        <button class="flex-1 bg-red-100 hover:bg-red-200 text-red-600 font-semibold py-2 rounded-lg transition" onclick="event.stopPropagation(); declineOrder('${order.id}')">
                            <i data-lucide="x" class="w-4 h-4 inline mr-1"></i> Decline
                        </button>
                        <button class="flex-1 bg-green-100 hover:bg-green-200 text-green-600 font-semibold py-2 rounded-lg transition" onclick="event.stopPropagation(); openOrderModal('${order.id}')">
                            <i data-lucide="eye" class="w-4 h-4 inline mr-1"></i> Details
                        </button>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // No sample orders ‚Äî ready to be populated from server
        const sampleOrders = [];

        // Order Details Modal Functions
        function openOrderModal(orderId) {
            const order = sampleOrders.find(o => o.id === orderId);
            if (order) {
                document.getElementById('orderModal').classList.remove('hidden');
                document.getElementById('orderModal').classList.add('flex');
                
                // Populate pickup details
                document.getElementById('ordModalPickup').innerHTML = `
                    <p class="font-semibold text-slate-800">${order.storeName}</p>
                    <p class="text-slate-600">${order.pickupAddress}</p>
                    <div class="mt-3 pt-3 border-t">
                        <p class="text-xs text-slate-500 uppercase font-bold">Estimated Wait</p>
                        <p class="font-semibold text-slate-800">${order.prepTime} min</p>
                    </div>
                `;
                
                // Populate dropoff details
                document.getElementById('ordModalDropoff').innerHTML = `
                    <p class="font-semibold text-slate-800">${order.dropoffAddress}</p>
                    <p class="text-slate-600">${order.dropoffDetails}</p>
                    <div class="mt-3 pt-3 border-t">
                        <p class="text-xs text-slate-500 uppercase font-bold">Distance</p>
                        <p class="font-semibold text-slate-800">${order.distance}</p>
                    </div>
                `;
                
                // Populate distance and time
                document.getElementById('ordModalDistance').textContent = order.distance;
                document.getElementById('ordModalTime').textContent = order.estimatedTime + ' min';
                
                // Populate items count
                document.getElementById('ordModalItems').textContent = order.items.length + ' items';
                
                // Populate items list
                const itemsList = document.getElementById('ordModalItemsList');
                itemsList.innerHTML = order.items.map(item => `
                    <div class="flex justify-between py-2 border-b">
                        <span>${item.qty}x ${item.name}</span>
                        <span class="font-semibold">$${(item.price * item.qty).toFixed(2)}</span>
                    </div>
                `).join('');
                
                // Populate customer info
                document.getElementById('ordModalCustName').textContent = order.customerName;
                document.getElementById('ordModalCustRating').textContent = order.customerRating;

                // Store current order ID for later use
                window.currentOrderId = orderId;
            }
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.add('hidden');
            document.getElementById('orderModal').classList.remove('flex');
        }

        function acceptOrder() {
            const orderId = window.currentOrderId;
            const order = sampleOrders.find(o => o.id === orderId);
            closeOrderModal();
            
            // Show active delivery section
            showActiveDelivery(order);
            
            // Start delivery timer
            startDeliveryTimer();
        }

        function declineOrder(orderId) {
            const index = sampleOrders.findIndex(o => o.id === orderId);
            if (index > -1) {
                sampleOrders.splice(index, 1);
                generateOrderCards();
            }
        }

        // Active Delivery Functions
        function showActiveDelivery(order) {
            const container = document.getElementById('activeDeliveryContainer');
            const emptyState = document.getElementById('activeEmptyState');
            
            // Hide empty state, show delivery container
            emptyState.classList.add('hidden');
            container.classList.remove('hidden');
            
            // Populate delivery details
            document.getElementById('activeOrderId').textContent = `Order #${order.id}`;
            document.getElementById('pickupStore').textContent = order.storeName;
            document.getElementById('pickupAddress').textContent = order.pickupAddress;
            document.getElementById('pickupTime').textContent = `Estimated wait: ${order.prepTime} min`;
            
            document.getElementById('dropoffLocation').textContent = order.dropoffAddress;
            document.getElementById('dropoffDetails').textContent = order.dropoffDetails;
            document.getElementById('dropoffTime').textContent = `Estimated delivery: ${order.estimatedTime} min`;
            
            document.getElementById('customerName').textContent = order.customerName;
            document.getElementById('customerRating').textContent = `Rating: ${order.customerRating} ‚≠ê`;
            
            document.getElementById('remainDistance').textContent = order.distance;
            document.getElementById('remainETA').textContent = order.estimatedTime + ' min';
            
            // Populate order items
            const itemsList = document.getElementById('orderDetailsList');
            itemsList.innerHTML = order.items.map(item => `
                <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                    <span class="text-slate-700">${item.name}</span>
                    <span class="flex items-center gap-2">
                        <span class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs font-bold">x${item.qty}</span>
                        <span class="font-semibold">$${(item.price * item.qty).toFixed(2)}</span>
                    </span>
                </div>
            `).join('');
            
            // Switch to Active Delivery tab
            switchTab('active');
        }

        function startDeliveryTimer() {
            let seconds = 0;
            const timerInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                document.getElementById('deliveryTimer').textContent = 
                    `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }, 1000);
            window.deliveryTimerInterval = timerInterval;
        }

        // Photo Capture Functions
        function captureFromCamera() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.capture = 'environment';
            input.onchange = (e) => {
                handlePhotoUpload({files: e.target.files});
            };
            input.click();
        }

        function handlePhotoUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const img = e.target.result;
                    document.getElementById('capturedPhoto').src = img;
                    document.getElementById('photoPreview').classList.remove('hidden');
                    document.getElementById('noCameraState').classList.add('hidden');
                    
                    // Enable complete delivery button
                    document.getElementById('completeDeliveryBtn').disabled = false;
                };
                
                reader.readAsDataURL(file);
            }
        }

        function retakePhoto() {
            document.getElementById('photoInput').value = '';
            document.getElementById('photoPreview').classList.add('hidden');
            document.getElementById('noCameraState').classList.remove('hidden');
            document.getElementById('completeDeliveryBtn').disabled = true;
        }

        // Rating Modal Functions
        function openRatingModal() {
            document.getElementById('ratingModal').classList.remove('hidden');
            document.getElementById('ratingModal').classList.add('flex');
        }

        function closeRatingModal() {
            document.getElementById('ratingModal').classList.add('hidden');
            document.getElementById('ratingModal').classList.remove('flex');
            showCompletionModal();
        }

        function submitRating() {
            const ratingValue = document.querySelector('.star-btn.selected')?.dataset.rating || '5';
            const feedback = document.getElementById('feedbackText').value;
            
            console.log('Rating submitted:', {
                rating: ratingValue,
                feedback: feedback,
                timestamp: new Date().toISOString()
            });
            
            // Send notification to store owner
            sendDeliveryNotification(currentDelivery);
            
            closeRatingModal();
        }

        function showCompletionModal() {
            document.getElementById('completionModal').classList.remove('hidden');
            document.getElementById('completionModal').classList.add('flex');
            // Show store notification confirmation
            document.getElementById('storeNotificationDiv').classList.remove('hidden');
        }

        function resetDelivery() {
            // Clear active delivery
            document.getElementById('activeDeliveryContainer').classList.add('hidden');
            document.getElementById('activeEmptyState').classList.remove('hidden');
            document.getElementById('completionModal').classList.add('hidden');
            document.getElementById('completionModal').classList.remove('flex');
            
            // Reset photo
            retakePhoto();
            
            // Clear timer
            if (window.deliveryTimerInterval) {
                clearInterval(window.deliveryTimerInterval);
            }
            
            // Switch back to available orders
            switchTab('orders');
            
            // Show success message
            alert('Ready for your next delivery!');
        }

        // Tab switching for earnings
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('text-blue-600', 'border-blue-600');
                    b.classList.add('text-slate-600', 'border-transparent');
                });
                this.classList.add('text-blue-600', 'border-blue-600');
                this.classList.remove('text-slate-600', 'border-transparent');
            });
        });

        // Star rating interactivity
        document.addEventListener('DOMContentLoaded', function() {
            const starButtons = document.querySelectorAll('.star-btn');
            starButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const rating = this.dataset.rating;
                    starButtons.forEach(b => {
                        b.classList.remove('selected');
                        b.classList.add('opacity-50');
                    });
                    for (let i = 0; i < rating; i++) {
                        starButtons[i].classList.remove('opacity-50');
                        starButtons[i].classList.add('selected');
                    }
                });
            });
        });

        // ============= STORE NOTIFICATION SYSTEM =============
        // Notifications are kept in-memory until server integration
        let storeNotifications = [];

        // Send Delivery Notification to Store Owner
        function sendDeliveryNotification(delivery) {
            if (!delivery) return;

            const notification = {
                id: 'NOTIF_' + Date.now(),
                type: 'delivery_completed',
                orderID: delivery.pickup?.name || 'Unknown Order',
                storeName: delivery.pickup?.name || 'Store',
                deliveryAddress: delivery.dropoff?.name || 'Unknown Address',
                timestamp: new Date().toISOString(),
                status: 'unread',
                message: `Order from ${delivery.pickup?.name || 'Store'} has been successfully delivered!`
            };

            // Add new notification (in-memory)
            storeNotifications.unshift(notification);
            if (storeNotifications.length > 50) storeNotifications = storeNotifications.slice(0,50);
            
            // Try to show browser notification if supported
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Order Delivered!', {
                    body: `Order from ${notification.storeName} delivered to ${notification.deliveryAddress}`,
                    icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNiIgZmlsbD0iIzEwQjk4MSIvPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0xMiAyMGw0IDQgOC04Ii8+PC9zdmc+',
                    tag: 'delivery_' + notification.id
                });
            }
            
            console.log('‚úì Store notification sent:', notification);
            return notification;
        }

        // Get Store Notifications (in-memory)
        function getStoreNotifications() { return storeNotifications; }

        // Mark notification as read
        function markNotificationAsRead(notificationId) {
            const notification = storeNotifications.find(n => n.id === notificationId);
            if (notification) notification.status = 'read';
        }

        // Clear all notifications
        function clearAllNotifications() { storeNotifications = []; console.log('‚úì All notifications cleared (in-memory)'); }

        // Initialize notifications on page load (no-op for in-memory)
        
        // Request browser notification permission if not already granted
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // ============= NOTIFICATION PANEL FUNCTIONS =============
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('hidden');
            if (!panel.classList.contains('hidden')) {
                updateNotificationPanel();
            }
        }

        function updateNotificationPanel() {
            const notifications = getStoreNotifications();
            const notificationsList = document.getElementById('notificationsList');
            const badge = document.getElementById('notificationBadge');

            // Update badge count
            const unreadCount = notifications.filter(n => n.status === 'unread').length;
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }

            // Render notifications
            if (notifications.length === 0) {
                notificationsList.innerHTML = '<div class="p-8 text-center text-slate-500"><i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 text-slate-300"></i><p class="text-sm">No notifications yet</p></div>';
                lucide.createIcons();
                return;
            }

            notificationsList.innerHTML = notifications.map(notif => `
                <div class="p-4 border-b hover:bg-gray-50 transition cursor-pointer" onclick="markNotificationAsRead('${notif.id}')">
                    <div class="flex items-start gap-3">
                        <div class="mt-1">
                            ${notif.status === 'unread' ? '<div class="w-2 h-2 bg-blue-500 rounded-full"></div>' : '<div class="w-2 h-2 bg-transparent"></div>'}
                        </div>
                        <div class="flex-1">
                            <p class="font-semibold text-slate-800 text-sm">${notif.message}</p>
                            <p class="text-xs text-slate-500 mt-1">üìç ${notif.deliveryAddress}</p>
                            <p class="text-xs text-slate-400 mt-2">${new Date(notif.timestamp).toLocaleString()}</p>
                        </div>
                        <span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded font-bold">‚úì Delivered</span>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // Update notification panel when notifications are added
        const originalSendNotification = sendDeliveryNotification;
        sendDeliveryNotification = function(delivery) {
            const result = originalSendNotification(delivery);
            setTimeout(() => updateNotificationPanel(), 300);
            return result;
        };

        // Earnings Chart Initialization
        const earningsCtx = document.getElementById('earningsChart').getContext('2d');
        new Chart(earningsCtx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Earnings ($)',
                    data: [45, 52, 48, 65, 58, 72, 80],
                    borderColor: '#2563eb',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    backgroundColor: (context) => {
                        const gradient = earningsCtx.createLinearGradient(0, 0, 0, 400);
                        gradient.addColorStop(0, 'rgba(37, 99, 235, 0.2)');
                        gradient.addColorStop(1, 'rgba(37, 99, 235, 0)');
                        return gradient;
                    },
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#2563eb',
                    pointBorderWidth: 2,
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { grid: { color: '#f1f5f9' }, ticks: { font: { family: 'Inter' } } },
                    x: { grid: { display: false } }
                }
            }
        });
        // GPS and Map Variables
        let deliveryMap = null;
        let pickupMarker = null;
        let dropoffMarker = null;
        let riderMarker = null;
        let routeLine = null;
        let simulationInterval = null;
        let currentDelivery = null;
        let riderProgress = 0;

        // Initialize Delivery Map
        function initializeDeliveryMap(pickup, dropoff) {
            // Create map centered between pickup and dropoff
            const center = [(pickup.lat + dropoff.lat) / 2, (pickup.lng + dropoff.lng) / 2];
            
            if (deliveryMap) {
                deliveryMap.remove();
            }
            
            deliveryMap = L.map('deliveryMap').setView(center, 13);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(deliveryMap);
            
            // Add pickup marker
            pickupMarker = L.marker(pickup.coords, {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDMyIDQwIj48cGF0aCBmaWxsPSIjRkY5ODAwIiBkPSJNMTYgMEM3IDAgMCAxMDAgNyAxOGM0IDUgOSAxMiAxNiAyMmM3LTEwIDEyLTE3IDE2LTIyYzcgMTUgMDI1IDE0IDE2IDE2YzAgMCAwIDAgMCAweiIvPjwvc3ZnPg==',
                    iconSize: [32, 40],
                    iconAnchor: [16, 40],
                    popupAnchor: [0, -40]
                })
            }).addTo(deliveryMap).bindPopup('üì¶ Pickup Location<br>' + pickup.name);
            
            // Add dropoff marker
            dropoffMarker = L.marker(dropoff.coords, {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDMyIDQwIj48cGF0aCBmaWxsPSIjMTBCOTgxIiBkPSJNMTYgMEM3IDAgMCAxMDAgNyAxOGM0IDUgOSAxMiAxNiAyMmM3LTEwIDEyLTE3IDE2LTIyYzcgMTUgMDI1IDE0IDE2IDE2YzAgMCAwIDAgMCAweiIvPjwvc3ZnPg==',
                    iconSize: [32, 40],
                    iconAnchor: [16, 40],
                    popupAnchor: [0, -40]
                })
            }).addTo(deliveryMap).bindPopup('üìç Delivery Location<br>' + dropoff.name);
            
            // Add rider marker
            riderMarker = L.marker(pickup.coords, {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNiIgZmlsbD0iIzI1NjNlYiIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjgiIGZpbGw9IiNmZmYiLz48L3N2Zz4=',
                    iconSize: [32, 32],
                    iconAnchor: [16, 16],
                    popupAnchor: [0, -16]
                })
            }).addTo(deliveryMap).bindPopup('üèçÔ∏è Your Location');
            
            // Draw route line
            routeLine = L.polyline([pickup.coords, dropoff.coords], {
                color: '#2563eb',
                weight: 3,
                opacity: 0.7,
                dashArray: '5, 5'
            }).addTo(deliveryMap);
            
            // Fit map to bounds
            const bounds = L.latLngBounds([pickup.coords, dropoff.coords]);
            deliveryMap.fitBounds(bounds, { padding: [50, 50] });
            
            console.log('‚úì Delivery map initialized');
        }

        function centerMapOnDelivery() {
            if (deliveryMap && riderMarker) {
                deliveryMap.setView(riderMarker.getLatLng(), 15);
            }
        }

        function toggleFullscreenMap() {
            const mapContainer = document.getElementById('deliveryMap');
            if (!document.fullscreenElement) {
                mapContainer.requestFullscreen().catch(err => {
                    console.log('Fullscreen request failed:', err);
                    // Fallback: show message
                    alert('Fullscreen not supported on this device');
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Simulate GPS tracking (real-time updates)
        function startGPSSimulation(pickup, dropoff, estimatedTime) {
            // Cancel any existing simulation
            if (simulationInterval) {
                clearInterval(simulationInterval);
            }
            
            riderProgress = 0;
            const totalSteps = Math.min(estimatedTime * 2, 120); // Update every 30 seconds in real time or 2x per minute
            const stepInterval = (estimatedTime * 60 * 1000) / totalSteps; // Convert to milliseconds
            
            simulationInterval = setInterval(() => {
                riderProgress++;
                
                if (riderProgress >= totalSteps) {
                    clearInterval(simulationInterval);
                    simulationInterval = null;
                    return;
                }
                
                // Calculate interpolated position between pickup and dropoff
                const progress = riderProgress / totalSteps;
                const currentLat = pickup.coords[0] + (dropoff.coords[0] - pickup.coords[0]) * progress;
                const currentLng = pickup.coords[1] + (dropoff.coords[1] - pickup.coords[1]) * progress;
                
                if (riderMarker) {
                    riderMarker.setLatLng([currentLat, currentLng]);
                    
                    // Update location text
                    const status = progress < 0.3 ? 'Going to pickup' : progress < 0.7 ? 'Picking up order' : 'On way to delivery';
                    document.getElementById('currentLocationText').textContent = status;
                    
                    // Calculate remaining distance and ETA
                    const remainingDistance = ((1 - progress) * calculateDistance(pickup.coords, dropoff.coords)).toFixed(1);
                    const remainingTime = Math.ceil((1 - progress) * estimatedTime);
                    
                    document.getElementById('mapDistance').textContent = remainingDistance + ' km';
                    document.getElementById('remainETA').textContent = remainingTime + ' min';
                }
            }, stepInterval);
        }

        // Calculate distance between two coordinates (Haversine formula)
        function calculateDistance(coords1, coords2) {
            const [lat1, lng1] = coords1;
            const [lat2, lng2] = coords2;
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng / 2) * Math.sin(dLng / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        // Modify showActiveDelivery to initialize map
        const originalShowActiveDelivery = showActiveDelivery;
        showActiveDelivery = function(order) {
            originalShowActiveDelivery(order);
            
            // Wait for DOM to be ready, then initialize map
            setTimeout(() => {
                // Sample coordinates - in real app, get from database
                const pickupCoords = {
                    name: order.storeName,
                    coords: [40.7128 + (Math.random() - 0.5) * 0.05, -74.0060 + (Math.random() - 0.5) * 0.05]
                };
                
                const dropoffCoords = {
                    name: order.dropoffAddress,
                    coords: [40.7128 + (Math.random() - 0.5) * 0.1, -74.0060 + (Math.random() - 0.5) * 0.1]
                };
                
                initializeDeliveryMap(pickupCoords, dropoffCoords);
                startGPSSimulation(pickupCoords, dropoffCoords, parseInt(order.estimatedTime));
                currentDelivery = { pickup: pickupCoords, dropoff: dropoffCoords };
            }, 100);
        };

        // Account Verification Modal Functions
        function openVerifyModal() {
            const modal = document.getElementById('verifyModal');
            modal.classList.remove('hidden');
            lucide.createIcons();
            
            // Load existing verification data
            loadVerificationData();
            
            // Close on ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    closeVerifyModal();
                }
            });
        }

        function closeVerifyModal() {
            const modal = document.getElementById('verifyModal');
            modal.classList.add('hidden');
        }

        function loadVerificationData() {
            const verifyData = JSON.parse(localStorage.getItem('verificationData') || '{}');
            
            if (verifyData.contactNumber) {
                document.getElementById('contactNumber').value = verifyData.contactNumber;
            }
            
            // Load and display previews
            if (verifyData.idFront) {
                displayPreview('idFront', verifyData.idFront);
            }
            if (verifyData.idBack) {
                displayPreview('idBack', verifyData.idBack);
            }
            if (verifyData.selfie) {
                displayPreview('selfieId', verifyData.selfie);
            }
            if (verifyData.addressProof) {
                displayPreview('addressProof', verifyData.addressProof);
            }
        }

        function displayPreview(inputId, dataUrl) {
            const input = document.getElementById(inputId);
            const previewId = inputId === 'addressProof' ? 'addressPreview' : 
                            inputId === 'selfieId' ? 'selfiePreview' :
                            inputId === 'idBack' ? 'idBackPreview' : 'idFrontPreview';
            const preview = document.getElementById(previewId);
            
            if (dataUrl.endsWith('.pdf') || dataUrl.includes('pdf')) {
                preview.innerHTML = '<i data-lucide="file-pdf" class="w-12 h-12 mx-auto text-red-500"></i><p class="text-slate-600 text-sm mt-2">PDF Document Uploaded</p>';
            } else {
                preview.innerHTML = `<img src="${dataUrl}" class="w-full h-48 object-cover rounded-lg">`;
            }
            lucide.createIcons();
        }

        // File input handlers with validation
        document.addEventListener('DOMContentLoaded', function() {
            const fileInputs = ['idFront', 'idBack', 'selfieId', 'addressProof'];
            
            fileInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('change', function(e) {
                        validateAndPreviewFile(e, inputId);
                    });
                }
            });
            
            // Handle form submission
            const form = document.getElementById('verifyForm');
            if (form) {
                form.addEventListener('submit', handleVerificationSubmit);
            }
        });

        function validateAndPreviewFile(event, inputId) {
            const file = event.target.files[0];
            if (!file) return;
            
            const maxSize = 5 * 1024 * 1024; // 5MB
            const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];
            
            // Validate file type
            if (!allowedTypes.includes(file.type)) {
                showToast('Only JPG, PNG, and PDF files are allowed', 'error');
                event.target.value = '';
                return;
            }
            
            // Validate file size
            if (file.size > maxSize) {
                showToast('File size must be less than 5MB', 'error');
                event.target.value = '';
                return;
            }
            
            // Read and display preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewId = inputId === 'addressProof' ? 'addressPreview' : 
                                inputId === 'selfieId' ? 'selfiePreview' :
                                inputId === 'idBack' ? 'idBackPreview' : 'idFrontPreview';
                
                if (file.type === 'application/pdf') {
                    document.getElementById(previewId).innerHTML = '<i data-lucide="file-pdf" class="w-12 h-12 mx-auto text-red-500"></i><p class="text-slate-600 text-sm mt-2">PDF Uploaded: ' + file.name + '</p>';
                } else {
                    document.getElementById(previewId).innerHTML = `<img src="${e.target.result}" class="w-full h-48 object-cover rounded-lg"><p class="text-slate-600 text-xs mt-2">${file.name}</p>`;
                }
                
                lucide.createIcons();
            };
            reader.readAsDataURL(file);
        }

        function handleVerificationSubmit(event) {
            event.preventDefault();
            
            // Validate required fields
            const idFront = document.getElementById('idFront').files[0];
            const idBack = document.getElementById('idBack').files[0];
            const selfie = document.getElementById('selfieId').files[0];
            const address = document.getElementById('addressProof').files[0];
            const contact = document.getElementById('contactNumber').value.trim();
            
            if (!idFront || !idBack || !selfie || !address || !contact) {
                showToast('Please complete all fields before submitting', 'error');
                return;
            }
            
            // Validate contact number format (basic)
            if (!/^\+?[\d\s\-()]{10,}$/.test(contact)) {
                showToast('Please enter a valid contact number', 'error');
                return;
            }
            
            // Store verification data
            const reader1 = new FileReader();
            reader1.onload = function(e1) {
                const reader2 = new FileReader();
                reader2.onload = function(e2) {
                    const reader3 = new FileReader();
                    reader3.onload = function(e3) {
                        const reader4 = new FileReader();
                        reader4.onload = function(e4) {
                            const verifyData = {
                                idFront: e1.target.result,
                                idBack: e2.target.result,
                                selfie: e3.target.result,
                                addressProof: e4.target.result,
                                contactNumber: contact,
                                submittedAt: new Date().toISOString(),
                                status: 'pending'
                            };
                            
                            localStorage.setItem('verificationData', JSON.stringify(verifyData));
                            showToast('‚úì Verification submitted successfully! Our team will review and contact you within 24-48 hours.', 'success');
                            
                            // Reset form and close modal
                            document.getElementById('verifyForm').reset();
                            setTimeout(() => {
                                closeVerifyModal();
                                loadProfile(); // Update profile to show verification badge
                            }, 2000);
                        };
                        reader4.readAsDataURL(address);
                    };
                    reader3.readAsDataURL(selfie);
                };
                reader2.readAsDataURL(idBack);
            };
            reader1.readAsDataURL(idFront);
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container') || (() => {
                const container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'fixed top-4 right-4 z-[9999]';
                document.body.appendChild(container);
                return container;
            })();
            
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600';
            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg animate-pulse mb-3 max-w-sm`;
            toast.textContent = message;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }
    </script>
</body>
</html>
